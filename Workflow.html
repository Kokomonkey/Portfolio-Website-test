<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI in Architecture Workflow</title>
    <style>
        /* --- CSS VARIABLES & THEMING --- */
        :root {
            /* Light Mode Default */
            --bg-color: #e6e6e6;
            --text-color: #1a1a1a;
            --container-bg: #ffffff;
            --container-border: #000000;
            --accent-color: #ff3333; 
            --secondary-accent: #4a90e2; 
            --dot-color: #cccccc;
            
            --line-color: #000000; 
            --line-active: #ff3333;
            
            --font-main: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            --font-mono: 'Courier New', Courier, monospace;
        }

        [data-theme="dark"] {
            --bg-color: #121212;
            --text-color: #e0e0e0;
            --container-bg: #1e1e1e;
            --container-border: #ffffff;
            --dot-color: #333333;
            
            --line-color: #ffffff; 
            --line-active: #ff5555;
        }

        /* --- GLOBAL RESET --- */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: var(--font-main);
            background-color: var(--bg-color);
            color: var(--text-color);
            overflow: hidden; 
            height: 100vh;
            width: 100vw;
            transition: background-color 0.3s;
        }

        .bg-pattern {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background-image: radial-gradient(var(--dot-color) 2px, transparent 2px);
            background-size: 25px 25px;
            z-index: -1;
            pointer-events: none;
        }

        /* --- UI LAYER --- */
        .ui-layer {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            z-index: 1000;
            transition: opacity 0.5s ease;
        }
        
        /* Intro Hide State for UI */
        .ui-hidden { opacity: 0; }

        .header-container {
            pointer-events: auto;
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            background: var(--bg-color);
            padding: 10px 30px;
            border: 2px solid var(--container-border);
            border-radius: 50px;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .logo-placeholder {
            width: 30px; height: 30px;
            background: var(--text-color);
            border-radius: 50%;
        }

        h1 {
            font-size: 1.2rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 800;
            margin: 0;
        }

        .back-btn { 
            pointer-events: auto;
            position: absolute; 
            top: 30px; 
            left: 30px; 
            text-decoration: none; 
            border: 2px solid var(--accent-color); 
            background-color: var(--bg-color); 
            color: var(--accent-color); 
            padding: 10px 20px; 
            font-family: var(--font-mono); 
            font-weight: bold; 
            text-transform: uppercase; 
            font-size: 0.9rem; 
            transition: all 0.2s ease; 
        }
        .back-btn:hover { 
            background-color: var(--accent-color); 
            color: var(--bg-color); 
        }

        .controls {
            pointer-events: auto;
            position: absolute;
            bottom: 30px; right: 30px;
            display: flex; gap: 10px;
        }

        .btn-ui {
            background: var(--container-bg);
            border: 1px solid var(--container-border);
            color: var(--text-color);
            padding: 10px 15px;
            cursor: pointer;
            font-family: var(--font-mono);
            font-weight: bold;
        }
        .btn-ui:hover { background: var(--dot-color); }

        /* --- INTRO OVERLAY --- */
        #intro-overlay {
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh;
            background: var(--bg-color);
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            pointer-events: none;
            transition: opacity 0.5s ease-out;
        }
        #intro-overlay.finished { opacity: 0; }
        
        .terminal-text {
            font-family: var(--font-mono);
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--text-color);
        }
        .cursor {
            display: inline-block;
            width: 10px; height: 20px;
            background: var(--accent-color);
            animation: blink 0.8s infinite;
        }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }

        /* --- CANVAS --- */
        #canvas-wrapper {
            width: 100%; height: 100%;
            overflow: hidden;
            cursor: grab;
            opacity: 0; /* Hidden initially */
            transition: opacity 1s ease;
        }
        #canvas-wrapper.visible { opacity: 1; }
        #canvas-wrapper:active { cursor: grabbing; }

        #workflow-root {
            position: absolute;
            top: 50%; left: 50%; 
            transform-origin: 0 0; 
            width: 0; height: 0; 
        }

        /* --- NODES --- */
        .step-node {
            position: absolute;
            width: 240px;
            background: var(--container-bg);
            border: 2px solid var(--accent-color);
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            z-index: 10;
            user-select: none;
            
            /* ANIMATION STATES */
            opacity: 0;
            transform: translateY(50px) scale(0.9);
            transition: opacity 0.6s cubic-bezier(0.34, 1.56, 0.64, 1), 
                        transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        
        /* The class added by JS to trigger the pop-in */
        .step-node.intro-active {
            opacity: 1;
            transform: translateY(0) scale(1);
        }

        .step-node:hover { transform: scale(1.02); }
        .step-header { font-weight: 800; text-transform: uppercase; font-size: 0.9rem; margin-bottom: 5px; }
        .step-desc { font-size: 0.75rem; color: #666; line-height: 1.3; }

        .task-group {
            position: absolute;
            display: flex;
            flex-direction: column;
            gap: 20px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            z-index: 5;
        }
        .task-group.visible { opacity: 1; pointer-events: auto; }

        .task-node {
            width: 240px;
            background: var(--container-bg);
            border: 1px solid var(--container-border);
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            position: relative;
        }
        .task-node:hover { background-color: var(--bg-color); }
        .task-title { font-weight: 700; font-size: 0.85rem; margin-bottom: 4px; }
        .task-desc { font-size: 0.7rem; color: #666; }

        .ai-group {
            position: absolute;
            left: 365px; 
            top: 50%;
            transform: translate(-50%);
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 280px;
            opacity: 0;
            pointer-events: none;
            transform: translateX(-10px);
            transition: all 0.3s ease;
        }
        .ai-group.visible { opacity: 1; pointer-events: auto; transform: translateX(0); }

        .ai-node {
            background: var(--container-bg);
            border: 1px solid var(--container-border);
            border-left: 4px solid var(--text-color);
            border-radius: 4px;
            padding: 12px;
            font-size: 0.8rem;
            cursor: pointer; /* Interaction Cue */
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .ai-node:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }

        .ai-header { display: flex; align-items: center; gap: 8px; margin-bottom: 6px; }
        .ai-logo { width: 16px; height: 16px; background: #ccc; border-radius: 50%; }
        .ai-name { font-weight: bold; }
        .ai-desc { font-size: 0.7rem; color: #666; margin-bottom: 8px; line-height: 1.3;}
        .ai-meta { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; font-size: 0.65rem; font-family: var(--font-mono); border-top: 1px solid var(--line-color); padding-top: 6px; }
        .pro { color: #2ecc71; }
        .con { color: #e74c3c; }
        .price { color: var(--secondary-accent); font-weight: bold; grid-column: span 2; }
        
        .ai-link {
            display: block; margin-top: 6px; 
            text-align: right; font-size: 0.7rem; 
            text-decoration: none; color: var(--text-color); 
            border-bottom: 1px dotted var(--text-color);
            width: fit-content; margin-left: auto;
        }

        /* --- SVG LINES --- */
        svg {
            position: absolute;
            overflow: visible;
            pointer-events: none;
            z-index: 1;
            top: 0; left: 0;
        }
        path {
            fill: none;
            stroke: var(--line-color);
            stroke-width: 2;
            transition: stroke 0.3s;
        }
        
        /* Animation class for lines appearing */
        .intro-path {
            stroke-dasharray: 1000;
            stroke-dashoffset: 1000;
            animation: dash 1.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }

        @keyframes dash {
            to { stroke-dashoffset: 0; }
        }

        .line-active { stroke: var(--line-active); stroke-width: 3; }


        /* --- NEW: SCREEN FILL OVERLAY (The Deep Dive Box) --- */
        #detail-overlay {
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh;
            background: rgba(0,0,0,0.8);
            z-index: 5000;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.4s ease;
            backdrop-filter: blur(5px);
        }

        #detail-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }

        .overlay-content {
            width: 90vw;
            height: 90vh;
            background: #000; /* High Contrast Theme from Reference */
            color: #fff;
            border: 2px solid #fff;
            display: flex;
            position: relative;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }

        .close-btn {
            position: absolute;
            top: 20px; right: 20px;
            width: 40px; height: 40px;
            background: #fff;
            color: #000;
            font-family: 'Helvetica Neue', sans-serif;
            font-size: 24px;
            font-weight: bold;
            display: flex; justify-content: center; align-items: center;
            cursor: pointer;
            z-index: 100;
            border: none;
        }
        .close-btn:hover { background: var(--accent-color); color: white; }

        /* The Split Layout */
        .detail-left {
            width: 40%;
            padding: 60px;
            border-right: 1px solid #333;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .detail-right {
            width: 60%;
            background: #000;
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr;
        }

        /* Typography for Overlay */
        .ov-title {
            font-size: 3rem;
            font-weight: 300;
            text-transform: uppercase;
            margin-bottom: 20px;
            line-height: 1;
            letter-spacing: -1px;
        }
        .ov-desc {
            font-size: 1.2rem;
            color: #ccc;
            margin-bottom: 40px;
            font-weight: 300;
            line-height: 1.5;
        }
        .ov-meta {
            margin-top: auto;
            border-top: 1px solid #333;
            padding-top: 20px;
            font-family: var(--font-mono);
            font-size: 0.9rem;
        }
        .ov-row { display: flex; justify-content: space-between; margin-bottom: 10px; }
        .ov-label { color: #666; }
        .ov-val { color: #fff; font-weight: bold; }

        .ov-btn {
            display: inline-block;
            margin-top: 30px;
            padding: 15px 30px;
            border: 1px solid #fff;
            color: #fff;
            text-decoration: none;
            text-transform: uppercase;
            font-weight: bold;
            transition: 0.3s;
            text-align: center;
        }
        .ov-btn:hover { background: #fff; color: #000; }

        /* Grid Items (From Inspiration Code) */
        .grid-square {
            border: 1px solid #333;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 30px;
        }
        .sq-img {
            width: 100%; height: 100%; object-fit: cover;
            position: absolute; top: 0; left: 0;
            opacity: 0.4; filter: grayscale(100%);
        }
        .sq-title {
            position: relative; z-index: 2;
            font-size: 1.2rem; font-weight: 700;
            text-transform: uppercase;
            border-bottom: 2px solid white;
            display: inline-block; padding-bottom: 10px; margin-bottom: 10px;
        }
        .sq-txt {
            position: relative; z-index: 2;
            font-size: 0.9rem; color: #aaa;
        }
        .sq-center { align-items: center; text-align: center; }

    </style>
</head>
<body data-theme="dark"> <div class="bg-pattern"></div>

    <div id="intro-overlay">
        <div class="terminal-text">Initializing Workflow...<span class="cursor"></span></div>
    </div>

    <div id="detail-overlay" onclick="closeDetailOverlay(event)">
        <div class="overlay-content" onclick="event.stopPropagation()"> <button class="close-btn" onclick="closeDetailOverlay()">×</button>
            
            <div class="detail-left">
                <h2 id="ov-title" class="ov-title">AI Name</h2>
                <p id="ov-desc" class="ov-desc">Description goes here.</p>
                
                <div class="ov-meta">
                    <div class="ov-row"><span class="ov-label">Pricing:</span> <span id="ov-price" class="ov-val">Free</span></div>
                    <div class="ov-row"><span class="ov-label">Pros:</span> <span id="ov-pro" class="ov-val" style="color:#2ecc71">Good</span></div>
                    <div class="ov-row"><span class="ov-label">Cons:</span> <span id="ov-con" class="ov-val" style="color:#e74c3c">Bad</span></div>
                </div>

                <a id="ov-link" href="#" target="_blank" class="ov-btn">Visit Website</a>
            </div>

            <div class="detail-right">
                <div class="grid-square">
                    <span class="sq-title">01. Workflow</span>
                    <p class="sq-txt">Integration method and API capabilities within the current pipeline architecture.</p>
                </div>
                <div class="grid-square">
                    <div style="background:#222; width:100%; height:100%; position:absolute; top:0; left:0;"></div>
                    <span class="sq-title" style="margin-top: auto;">[Visual Output]</span>
                </div>
                <div class="grid-square">
                    <div style="background:#1a1a1a; width:100%; height:100%; position:absolute; top:0; left:0;"></div>
                    <span class="sq-title" style="margin-top: auto;">[Data Model]</span>
                </div>
                <div class="grid-square sq-center">
                    <span class="sq-title">02. Efficiency</span>
                    <p class="sq-txt">Estimated time savings based on task automation parameters.</p>
                </div>
            </div>
        </div>
    </div>

    <div class="ui-layer ui-hidden" id="main-ui">
        <a href="index.html" class="back-btn">← Back</a>
        
        <div class="header-container">
            <div class="logo-placeholder"></div>
            <h1>AI in Architecture</h1>
        </div>

        <div class="controls">
            <button class="btn-ui" onclick="toggleTheme()">Dark/Light</button>
            <button class="btn-ui" onclick="resetView()">Reset View</button>
        </div>
    </div>

    <div id="canvas-wrapper">
        <div id="workflow-root">
            <svg id="connections-layer"></svg>
            </div>
    </div>

<script>
    
  /* --- ELABORATE DATA RESTRUCTURED FROM DOCUMENT --- */
const workflowData = [
  {
    title: "1. Pre-Design",
    desc: "Strategic Definition & Discovery",
    tasks: [
      {
        title: "Client Intake & Programming",
        desc: "Visioning workshops, user-needs surveys, and developing room data sheets/adjacency matrices.",
        ais: [
          { name: "Excel / Data Tools", desc: "Managing functional requirements and square footage targets.", price: "Standard", pro: "Structured brief", con: "Manual data entry", link: "#", target: "_blank" },
          { name: "Digital Blue Foam", desc: "Web-based generative design for sustainable feasibility studies.", price: "Subscription", pro: "Sustainability focus", con: "Web-only", link: "https://www.digitalbluefoam.com/", target: "_blank" },
          { name: "Crosby Studios", desc: "Generative interior design concepts.", price: "Varies", pro: "Aesthetic focus", con: "Niche use", link: "https://crosbystudios.com/", target: "_blank" }
        ]
      },
      {
        title: "Site & Regulatory Analysis",
        desc: "Topographic review, solar/climate analysis, and detailed zoning audit (FAR, setbacks, height).",
        ais: [
          { name: "Autodesk Forma", desc: "Real-time environmental analysis (wind, noise, sun) & conceptual site planning.", price: "Part of AEC Collection", pro: "Revit interoperability", con: "Subscription cost", link: "https://www.autodesk.com/eu/products/forma", target: "_blank" },
          { name: "Archistar", desc: "Property intelligence platform for checking zoning compliance instantly.", price: "Subscription", pro: "Regulatory data", con: "Region specific (AUS)", link: "https://www.archistar.ai/", target: "_blank" },
          { name: "Climate Studio", desc: "Environmental performance and solar orientation modeling.", price: "Subscription", pro: "Passive design", con: "Specialized", link: "https://www.solemma.com/climate-studio", target: "_blank" }
        ]
      },
      {
        title: "Feasibility & Budgeting",
        desc: "Developing Rough Order of Magnitude (ROM) cost models and testing project viability.",
        ais: [
          { name: "TestFit", desc: "Real-time generative deal solving and yield analysis.", price: "$5,000/yr", pro: "Instant ROI math", con: "Boxy geometry", link: "https://www.testfit.io/", target: "_blank" },
          { name: "Maket", desc: "Generative residential design for quick layout iterations.", price: "Free Tier / Sub", pro: "Fast residential", con: "Less complex commercial", link: "https://www.maket.ai/", target: "_blank" },
          { name: "qbiq", desc: "AI office layout planning and 3D virtual tours for test fits.", price: "Subscription", pro: "High speed layouts", con: "Office focused", link: "https://www.qbiq.ai/", target: "_blank" },
          { name: "Laiout", desc: "Automated floor plans for commercial real estate.", price: "Subscription", pro: "Instant options", con: "Commercial focus", link: "https://www.laiout.co/", target: "_blank" }
        ]
      }
    ]
  },
  {
    title: "2. Schematic Design",
    desc: "Concept Formulation & Form",
    tasks: [
      {
        title: "Parti & Concept Generation",
        desc: "Creating guiding organizational principles, sketches, and mood boards to establish design intent.",
        ais: [
          { name: "Midjourney", desc: "AI-driven atmospheric concept art for client visioning.", price: "$10/mo", pro: "Pure inspiration", con: "Non-technical", link: "https://www.midjourney.com/", target: "_blank" },
          { name: "LookX", desc: "AI tailored for architecture to generate renderings from massing models.", price: "Subscription", pro: "Architect-centric", con: "Learning curve", link: "https://www.lookx.ai/", target: "_blank" },
          { name: "PromeAI", desc: "Transform sketches into rendered concepts.", price: "Freemium", pro: "Easy sketch-to-image", con: "2D only", link: "https://www.promeai.pro/", target: "_blank" }
        ]
      },
      {
        title: "Massing & Spatial Studies",
        desc: "Drafting preliminary single-line plans and testing building scale/volume on site.",
        ais: [
          { name: "Rhino / SketchUp", desc: "Flexible 3D modeling for rapid iteration.", price: "Varies", pro: "Easy form making", con: "Lacks BIM data", link: "#", target: "_blank" },
          { name: "Finch 3D", desc: "Graph-based generative design for optimizing floor plans.", price: "Waitlist/Sub", pro: "Optimization logic", con: "Beta access", link: "https://finch3d.com/", target: "_blank" },
          { name: "ARCHITEChTURES", desc: "AI-powered residential building design generator.", price: "Subscription", pro: "Full building generation", con: "Strict parameters", link: "https://architechtures.com/", target: "_blank" },
          { name: "Conix", desc: "AI for residential zoning and planning optimization.", price: "Subscription", pro: "Zoning logic", con: "Region specific roots", link: "https://conix.ai/", target: "_blank" },
          { name: "PlanFinder", desc: "Plugin for Rhino/Revit to generate apartment layouts.", price: "Subscription", pro: "Direct plugin", con: "Residential only", link: "https://www.planfinder.xyz/", target: "_blank" },
          { name: "ArkDesign.ai", desc: "AI optimizing architectural floor plans for density and code.", price: "Subscription", pro: "Efficiency", con: "Strict logic", link: "https://arkdesign.ai/", target: "_blank" }
        ]
      },
      {
        title: "Visualization & VR",
        desc: "Producing renderings and VR walkthroughs to secure early client buy-in.",
        ais: [
          { name: "Veras (EvolveLAB)", desc: "AI rendering plugin directly inside Revit/Rhino.", price: "Subscription", pro: "In-model rendering", con: "Abstract results", link: "https://www.evolvelab.io/veras", target: "_blank" },
          { name: "Arko.ai", desc: "Cloud-based AI rendering for SketchUp/Revit/Rhino.", price: "Subscription", pro: "Cloud processing", con: "Upload time", link: "https://arko.ai/", target: "_blank" },
          { name: "Enscape", desc: "Real-time rendering integrated into the design workflow.", price: "$40/mo", pro: "Instant visuals", con: "High-end GPU req.", link: "https://enscape3d.com/", target: "_blank" }
        ]
      }
    ]
  },
  {
    title: "3. Design Development",
    desc: "Technical Refinement & Systems",
    tasks: [
      {
        title: "Federated Modeling",
        desc: "Integrating Structural and MEP models with Architecture for multi-discipline coordination.",
        ais: [
          { name: "Autodesk Revit", desc: "Core BIM authoring and information management.", price: "$2,500/yr", pro: "Fully integrated", con: "Steep learning", link: "https://www.autodesk.com/products/revit/overview", target: "_blank" },
          { name: "Augmenta", desc: "AI for automated electrical and systems design.", price: "Subscription", pro: "Systems automation", con: "Specialized", link: "https://www.augmenta.ai/", target: "_blank" },
          { name: "SkyCiv", desc: "Cloud-based structural engineering and analysis.", price: "Subscription", pro: "Cloud native", con: "Analysis focus", link: "https://skyciv.com/", target: "_blank" },
          { name: "Hypar", desc: "Cloud platform for generating building systems and logic.", price: "Subscription", pro: "Modular logic", con: "Coding knowledge help", link: "https://hypar.io/", target: "_blank" },
          { name: "Navisworks", desc: "Clash detection to resolve system conflicts early.", price: "Subscription", pro: "Reduces field errors", con: "Separate license", link: "https://www.autodesk.com/products/navisworks/overview", target: "_blank" }
        ]
      },
      {
        title: "Envelope & Interior Detailing",
        desc: "Refining wall sections, interior elevations, millwork, and waterproofing strategies.",
        ais: [
          { name: "Kaedim", desc: "Convert 2D images into 3D models for detailed assets.", price: "Subscription", pro: "Asset creation", con: "Not full BIM", link: "https://www.kaedim3d.com/", target: "_blank" },
          { name: "Sloyd", desc: "Generative 3D asset creation for props and details.", price: "Freemium", pro: "Fast assets", con: "Game-dev focus", link: "https://www.sloyd.ai/", target: "_blank" }
        ]
      },
      {
        title: "Specifications Refinement",
        desc: "Selecting specific products and creating Outline Specifications for key assemblies.",
        ais: [
          { name: "Specright", desc: "Specification data management to ensure product accuracy.", price: "Enterprise", pro: "Data standard", con: "Setup time", link: "https://www.specright.com/", target: "_blank" },
          { name: "Deltek Specpoint", desc: "Modern specification writing tool linked to BIM.", price: "Subscription", pro: "BIM integration", con: "Cost", link: "https://www.deltek.com/en/architecture-and-engineering/specpoint", target: "_blank" }
        ]
      }
    ]
  },
  {
    title: "4. Construction Docs",
    desc: "Technical Execution & Permitting",
    tasks: [
      {
        title: "Production Drafting",
        desc: "Creating fully dimensioned and annotated working drawings for legal construction.",
        ais: [
          { name: "Swapp", desc: "AI that automates construction documents from models.", price: "Enterprise", pro: "Massive time save", con: "Loss of control", link: "https://swapp.ai/", target: "_blank" },
          { name: "Glyph (EvolveLAB)", desc: "Automating documentation tasks in Revit (tagging, dimensioning).", price: "Subscription", pro: "Task automation", con: "Revit only", link: "https://www.evolvelab.io/glyph", target: "_blank" }
        ]
      },
      {
        title: "The Project Manual",
        desc: "Writing technical specifications using CSI MasterFormat to define quality standards.",
        ais: [
          { name: "SpecLink", desc: "Database-driven specification writing.", price: "Enterprise", pro: "Linked data", con: "Complex UI", link: "https://bspeclink.com/", target: "_blank" },
          { name: "Document Crunch", desc: "AI review of contracts and specifications for risk.", price: "Subscription", pro: "Risk mitigation", con: "Legal focus", link: "https://www.documentcrunch.com/", target: "_blank" }
        ]
      },
      {
        title: "QA/QC & Permitting",
        desc: "Internal redline reviews and submission to Authorities Having Jurisdiction (AHJ).",
        ais: [
          { name: "Bluebeam Revu", desc: "Advanced PDF markup and document coordination.", price: "Per user", pro: "Powerful review", con: "PC only", link: "https://www.bluebeam.com/", target: "_blank" }
        ]
      }
    ]
  },
  {
    title: "5. Bidding & Negotiation",
    desc: "Procurement & Contracts",
    tasks: [
      {
        title: "Bid Management",
        desc: "Issuing bid sets, conducting pre-bid conferences, and managing bidder RFIs.",
        ais: [
          { name: "SmartBid", desc: "Construction bid management software for GCs.", price: "Subscription", pro: "Sub database", con: "Legacy UI", link: "https://smartbid.co/", target: "_blank" },
          { name: "Procore", desc: "Construction management and bid package tracking.", price: "Enterprise", pro: "Centralized hub", con: "High cost", link: "https://www.procore.com/", target: "_blank" }
        ]
      },
      {
        title: "Bid Leveling & Analysis",
        desc: "Analyzing contractor bids to ensure a fair 'apples-to-apples' comparison.",
        ais: [
          { name: "Togal.AI", desc: "AI-powered estimating and takeoff from plans.", price: "Subscription", pro: "Fast takeoffs", con: "2D focus", link: "https://www.togal.ai/", target: "_blank" },
          { name: "Pelles.ai", desc: "AI for preconstruction and estimating.", price: "Subscription", pro: "Precon focus", con: "Newer entrant", link: "https://www.pelles.ai/", target: "_blank" }
        ]
      },
      {
        title: "Value Engineering (VE)",
        desc: "Identifying cost-saving alternatives without compromising essential design intent.",
        ais: [
          { name: "Drawer AI", desc: "AI for electrical estimating and optimization.", price: "Subscription", pro: "Trade specific", con: "Niche", link: "https://drawer.ai/", target: "_blank" },
          { name: "OpenCost", desc: "Open source cost monitoring.", price: "Free/Open", pro: "Transparency", con: "Dev focused", link: "https://www.opencost.io/", target: "_blank" }
        ]
      }
    ]
  },
  {
    title: "6. Construction Admin",
    desc: "Construction Realization",
    tasks: [
      {
        title: "Site Observation & Reports",
        desc: "Regular site visits to verify work conforms to the Construction Documents.",
        ais: [
          { name: "OpenSpace", desc: "360-degree photo documentation mapped to plans.", price: "Quote", pro: "Visual record", con: "Hardware cost", link: "https://www.openspace.ai/", target: "_blank" },
          { name: "PlanGrid", desc: "Mobile access to drawings and site reporting.", price: "Monthly", pro: "Real-time sync", con: "Tablet req.", link: "https://www.plangrid.com/", target: "_blank" }
        ]
      },
      {
        title: "Submittals & Shop Drawings",
        desc: "Reviewing contractor samples and technical drawings for design intent.",
        ais: [
          { name: "Part3", desc: "Automating the workflow for RFIs and submittals.", price: "$200/mo", pro: "Saves massive time", con: "Niche", link: "https://www.part3.io/", target: "_blank" }
        ]
      },
      {
        title: "Project Closeout",
        desc: "Managing the Punch List and issuing the Certificate of Substantial Completion.",
        ais: [
          { name: "Trunk Tools", desc: "AI for construction workflow and incentives.", price: "Subscription", pro: "Field engagement", con: "New approach", link: "https://www.trunktools.com/", target: "_blank" },
          { name: "Civils.ai", desc: "Construction data AI for managing project records.", price: "Subscription", pro: "Data search", con: "Civil focus", link: "https://civils.ai/", target: "_blank" }
        ]
      }
    ]
  }
];

    /* --- STATE --- */
    const state = {
        scale: 1,
        panning: false,
        pointX: 0,
        pointY: 0,
        startX: 0,
        startY: 0,
        openStep: null,
        openTask: { step: null, task: null },
        introComplete: false
    };

    const root = document.getElementById('workflow-root');
    const svgLayer = document.getElementById('connections-layer');
    const introOverlay = document.getElementById('intro-overlay');
    const mainUi = document.getElementById('main-ui');
    const canvasWrapper = document.getElementById('canvas-wrapper');

    const STEP_WIDTH = 240;
    const STEP_GAP = 150;
    const TASK_OFFSET_Y = 120;

    /* --- INIT & RENDER --- */
    function init() {
        renderNodes();
        
        // --- AUTO CENTERING LOGIC ---
        const totalWidth = (workflowData.length * STEP_WIDTH) + ((workflowData.length - 1) * STEP_GAP);
        
        state.pointX = -(totalWidth / 2);
        state.pointY = -150;

        updateTransform();
        
        // Start the Animation Sequence
        runIntroSequence();
    }

    /* --- ANIMATION SEQUENCE --- */
    function sleep(ms) { return new Promise(resolve => setTimeout(resolve, ms)); }

    async function runIntroSequence() {
        // 1. Text Typing Effect
        const textEl = document.querySelector('.terminal-text');
        textEl.innerHTML = `LOADING SYSTEM...<span class="cursor"></span>`;
        await sleep(600);
        textEl.innerHTML = `BUILDING NODES...<span class="cursor"></span>`;
        await sleep(600);
        
        // 2. Fade out overlay
        introOverlay.classList.add('finished');
        canvasWrapper.classList.add('visible');
        await sleep(400); // Wait for fade

        // 3. Reveal Nodes and Draw Lines Sequentially
        for (let i = 0; i < workflowData.length; i++) {
            // Reveal Node
            const node = document.getElementById(`step-${i}`);
            node.classList.add('intro-active');

            // If not the first node, draw line from previous
            if (i > 0) {
                // We create a temporary intro line with animation
                const prev = document.getElementById(`step-${i-1}`);
                const x1 = parseInt(prev.style.left) + STEP_WIDTH;
                const y1 = parseInt(prev.style.top) + prev.offsetHeight / 2;
                const x2 = parseInt(node.style.left); 
                const y2 = parseInt(node.style.top) + node.offsetHeight / 2;
                
                // Manually draw specific intro line
                const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
                const d = `M ${x1} ${y1} C ${x1+50} ${y1}, ${x2-50} ${y2}, ${x2} ${y2}`;
                path.setAttribute("d", d);
                path.classList.add('intro-path'); // Adds the draw animation
                svgLayer.appendChild(path);
            }

            await sleep(250); // Pause between steps for effect
        }

        // 4. Show UI and Finalize
        mainUi.classList.remove('ui-hidden');
        await sleep(500);
        
        // Switch state to allow normal interaction updates
        state.introComplete = true;
        
        // Initial draw of standard lines (replaces intro lines silently if triggered)
        // But for now, we leave the intro lines or clear and redraw. 
        // Best to just leave them until interaction happens.
        setTimeout(() => {
              introOverlay.style.display = 'none';
        }, 100);
    }


    function renderNodes() {
        workflowData.forEach((step, index) => {
            // Step
            const stepEl = document.createElement('div');
            stepEl.className = 'step-node';
            stepEl.id = `step-${index}`;
            stepEl.style.left = `${index * (STEP_WIDTH + STEP_GAP)}px`;
            stepEl.style.top = `0px`; 
            stepEl.innerHTML = `
                <div class="step-header">${step.title}</div>
                <div class="step-desc">${step.desc}</div>
            `;
            stepEl.onclick = (e) => toggleStep(index, e);
            root.appendChild(stepEl);

            // Task Group
            const taskGroup = document.createElement('div');
            taskGroup.className = 'task-group';
            taskGroup.id = `taskgroup-${index}`;
            taskGroup.style.left = `${index * (STEP_WIDTH + STEP_GAP)}px`;
            taskGroup.style.top = `${TASK_OFFSET_Y}px`;

            step.tasks.forEach((task, tIndex) => {
                const taskEl = document.createElement('div');
                taskEl.className = 'task-node';
                taskEl.id = `task-${index}-${tIndex}`;
                taskEl.innerHTML = `
                    <div class="task-title">${task.title}</div>
                    <div class="task-desc">${task.desc}</div>
                `;
                taskEl.onmouseenter = () => hoverTask(index, tIndex);
                taskEl.onclick = (e) => { e.stopPropagation(); hoverTask(index, tIndex); };

                // AI Group
                const aiGroup = document.createElement('div');
                aiGroup.className = 'ai-group';
                aiGroup.id = `aigroup-${index}-${tIndex}`;
                
                task.ais.forEach(ai => {
                    const aiEl = document.createElement('div');
                    aiEl.className = 'ai-node';
                    aiEl.innerHTML = `
                        <div class="ai-header">
                            <div class="ai-logo"></div>
                            <div class="ai-name">${ai.name}</div>
                        </div>
                        <div class="ai-desc">${ai.desc}</div>
                        <div class="ai-meta">
                            <span class="pro">+ ${ai.pro}</span>
                            <span class="con">- ${ai.con}</span>
                            <span class="price">${ai.price}</span>
                        </div>
                        <div class="ai-link" style="opacity:0.6">Click for Details</div> 
                    `;
                    // UPDATED CLICK HANDLER TO OPEN OVERLAY
                    aiEl.onclick = (e) => {
                        e.stopPropagation();
                        openDetailOverlay(ai);
                    }
                    
                    aiGroup.appendChild(aiEl);
                });
                
                taskEl.appendChild(aiGroup);
                taskGroup.appendChild(taskEl);
            });

            root.appendChild(taskGroup);
        });
    }

    /* --- OVERLAY INTERACTIONS --- */
    function openDetailOverlay(aiData) {
        // Populate the overlay
        document.getElementById('ov-title').innerText = aiData.name;
        document.getElementById('ov-desc').innerText = aiData.desc;
        document.getElementById('ov-price').innerText = aiData.price;
        document.getElementById('ov-pro').innerText = aiData.pro;
        document.getElementById('ov-con').innerText = aiData.con;
        document.getElementById('ov-link').href = aiData.link;
        
        // Show overlay
        document.getElementById('detail-overlay').classList.add('active');
    }

    function closeDetailOverlay(e) {
        // If triggered by event, ensure we aren't clicking inside the content box
        // (Handled by stopPropagation on content box, but good backup)
        document.getElementById('detail-overlay').classList.remove('active');
    }

    // Close on Escape Key
    document.addEventListener('keydown', (e) => {
        if(e.key === "Escape") closeDetailOverlay();
    });


    /* --- INTERACTIONS --- */
    function toggleStep(index, e) {
        if(!state.introComplete) return; // Prevent clicking during intro
        
        e.stopPropagation();
        const group = document.getElementById(`taskgroup-${index}`);
        
        if (state.openStep === index) {
            group.classList.remove('visible');
            state.openStep = null;
            state.openTask = { step: null, task: null };
            group.querySelectorAll('.ai-group').forEach(el => el.classList.remove('visible'));
        } else {
            if (state.openStep !== null) {
                const prev = document.getElementById(`taskgroup-${state.openStep}`);
                if(prev) {
                    prev.classList.remove('visible');
                    prev.querySelectorAll('.ai-group').forEach(el => el.classList.remove('visible'));
                }
            }
            state.openStep = index;
            group.classList.add('visible');
        }
        setTimeout(drawLines, 50); 
    }

    function hoverTask(stepIdx, taskIdx) {
        if(!state.introComplete) return;
        
        const group = document.getElementById(`taskgroup-${stepIdx}`);
        group.querySelectorAll('.ai-group').forEach(el => el.classList.remove('visible'));

        const target = document.getElementById(`aigroup-${stepIdx}-${taskIdx}`);
        target.classList.add('visible');
        
        state.openTask = { step: stepIdx, task: taskIdx };
        drawLines();
    }

    /* --- CANVAS & ZOOM --- */
    const wrapper = document.getElementById('canvas-wrapper');

    wrapper.addEventListener('mousedown', (e) => {
        if(e.target.closest('.step-node') || e.target.closest('.task-node') || e.target.closest('.ai-node')) return;
        state.panning = true;
        state.startX = e.clientX - state.pointX;
        state.startY = e.clientY - state.pointY;
        wrapper.style.cursor = 'grabbing';
    });

    window.addEventListener('mouseup', () => {
        state.panning = false;
        wrapper.style.cursor = 'grab';
    });

    window.addEventListener('mousemove', (e) => {
        if (!state.panning) return;
        e.preventDefault();
        state.pointX = e.clientX - state.startX;
        state.pointY = e.clientY - state.startY;
        updateTransform();
    });

    wrapper.addEventListener('wheel', (e) => {
        e.preventDefault();
        const xs = (e.clientX - state.pointX) / state.scale;
        const ys = (e.clientY - state.pointY) / state.scale;
        
        const delta = -e.deltaY;
        (delta > 0) ? (state.scale *= 1.1) : (state.scale /= 1.1);
        
        state.scale = Math.min(Math.max(0.1, state.scale), 4);

        state.pointX = e.clientX - xs * state.scale;
        state.pointY = e.clientY - ys * state.scale;

        updateTransform();
    }, { passive: false });

    function updateTransform() {
        root.style.transform = `translate(${state.pointX}px, ${state.pointY}px) scale(${state.scale})`;
    }

    function resetView() {
        state.scale = 1;
        const totalWidth = (workflowData.length * STEP_WIDTH) + ((workflowData.length - 1) * STEP_GAP);
        state.pointX = -(totalWidth / 2) + (STEP_WIDTH / 2);
        state.pointY = -150;
        updateTransform();
    }

    function toggleTheme() {
        const body = document.body;
        const current = body.getAttribute('data-theme');
        body.setAttribute('data-theme', current === 'dark' ? 'light' : 'dark');
    }

    /* --- SVG CONNECTIONS --- */
    function drawLines() {
        svgLayer.innerHTML = ''; 
        
        // 1. Horizontal Step Lines
        for(let i=0; i<workflowData.length-1; i++) {
            const curr = document.getElementById(`step-${i}`);
            const next = document.getElementById(`step-${i+1}`);
            
            const x1 = parseInt(curr.style.left) + STEP_WIDTH;
            const y1 = parseInt(curr.style.top) + curr.offsetHeight / 2;
            const x2 = parseInt(next.style.left); 
            const y2 = parseInt(next.style.top) + next.offsetHeight / 2;

            createPath(x1, y1, x2, y2, false);
        }

        // 2. Vertical Task Lines
        if(state.openStep !== null) {
            const stepEl = document.getElementById(`step-${state.openStep}`);
            const taskGroup = document.getElementById(`taskgroup-${state.openStep}`);
            const tasks = taskGroup.children;

            const startX = parseInt(stepEl.style.left) + STEP_WIDTH/2;
            const startY = parseInt(stepEl.style.top) + stepEl.offsetHeight;

            Array.from(tasks).forEach(task => {
                const tX = parseInt(taskGroup.style.left); 
                const tY = parseInt(taskGroup.style.top) + task.offsetTop + task.offsetHeight/2;
                
                const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
                const d = `M ${startX} ${startY} L ${startX} ${tY} L ${tX} ${tY}`;
                path.setAttribute("d", d);
                svgLayer.appendChild(path);
            });
        }

        // 3. Horizontal AI Lines
        if(state.openTask.step !== null && state.openTask.task !== null) {
    const tStep = state.openTask.step;
    const tIdx = state.openTask.task;
    const taskEl = document.getElementById(`task-${tStep}-${tIdx}`);
    const aiGroup = document.getElementById(`aigroup-${tStep}-${tIdx}`);
    
    if(aiGroup && aiGroup.classList.contains('visible')) {
        const ais = aiGroup.querySelectorAll('.ai-node');
        
        // Find the right edge of the task box
        const taskRect = taskEl.getBoundingClientRect();
        const rootRect = root.getBoundingClientRect();

        // Calculate coordinates relative to the workflow-root
        const x1 = (taskRect.right - rootRect.left) / state.scale;
        const y1 = (taskRect.top + taskRect.height / 2 - rootRect.top) / state.scale;

        ais.forEach(ai => {
            const aiRect = ai.getBoundingClientRect();
            
            // Destination: Left edge of the AI card
            const x2 = (aiRect.left - rootRect.left) / state.scale;
            const y2 = (aiRect.top + aiRect.height / 2 - rootRect.top) / state.scale;

            createPath(x1, y1, x2, y2, true);
        });
            }
        }
    }

    function createPath(x1, y1, x2, y2, isAI) {
        const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
        let d = "";
        if(isAI) {
            d = `M ${x1} ${y1} C ${x1+50} ${y1}, ${x2-50} ${y2}, ${x2} ${y2}`;
            path.classList.add('line-active');
        } else {
            d = `M ${x1} ${y1} C ${x1+50} ${y1}, ${x2-50} ${y2}, ${x2} ${y2}`;
        }
        path.setAttribute("d", d);
        svgLayer.appendChild(path);
    }

    window.addEventListener('resize', () => {
        resetView(); 
    });

    init();

</script>
</body>
</html>